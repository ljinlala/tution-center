<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subject Enrollment</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <link rel="stylesheet" href="nav.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        #subjects {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .subject-card {
            flex: 1 1 calc(50% - 15px); /* Two cards per row */
            box-sizing: border-box;
        }
        .subject-card {
            padding: 20px;
            background-color: #fff;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .subject-card h3 {
            margin: 0 0 10px;
        }
        .subject-card p {
            margin: 5px 0;
        }
        .enroll-button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .enroll-button:hover {
            background-color: #45a049;
        }
        #enrollment-form {
            margin-top: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            display: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        #enrollment-form input, #enrollment-form select {
            margin: 10px 0;
            padding: 8px;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #submit-enrollment {
            padding: 10px 15px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #submit-enrollment:hover {
            background-color: #0056b3;
        }
        #enrollment-status {
            margin-top: 20px;
            padding: 15px;
            background-color: #dff0d8;
            color: #3c763d;
            border: 1px solid #d6e9c6;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">Tuition Center</div>
        <ul>
            <li><a href="createProfile.html">Create Profile</a></li>
            <li><a href="fee.html">Fee</a></li>
            <li><a href="viewSchedule.html">View Schedule</a></li>
            <li><a href="agile.html">Report</a></li>
            <li><a href="login.html">Login</a></li>
            <li><a href="feedback.html">Feedback</a></li>
            <li><a href="payment.html">Payment</a></li>
            <li><a href="progress.html">Student Progress</a></li>
            <li><a href="gradeEntry.html">Grade Entry</a></li>
            <li><a href="notification.html">Notification</a></li>
            <li><a href="enroll.html">Enroll Subject</a></li>
            <li><a href="agile3.html">Teaching Schedule</a></li>
        </ul>
    </nav>
    <h1>Subject Enrollment</h1>

    <!-- Subjects List -->
    <div id="subjects">
        <div class="subject-card">
            <h3>Mathematics</h3>
            <p><strong>Teacher:</strong> Mr. Smith</p>
            <p><strong>Schedule:</strong> Mondays and Wednesdays, 10:00 AM - 11:30 AM</p>
            <p><strong>Cost:</strong> RM 150</p>
            <p><strong>Duration:</strong> 3 months</p>
            <p><strong>Location:</strong> Room 101</p>
            <button class="enroll-button" data-subject="Mathematics" data-cost="RM 150" data-duration="3 months">Select</button>
        </div>
        <div class="subject-card">
            <h3>Science</h3>
            <p><strong>Teacher:</strong> Ms. Johnson</p>
            <p><strong>Schedule:</strong> Mondays and Fridays, 11:00 AM - 11:30 AM</p>
            <p><strong>Cost:</strong> RM 180</p>
            <p><strong>Duration:</strong> 4 months</p>
            <p><strong>Location:</strong> Lab A</p>
            <button class="enroll-button" data-subject="Science" data-cost="RM 180" data-duration="4 months">Select</button>
        </div>
        <div class="subject-card">
            <h3>English Language</h3>
            <p><strong>Teacher:</strong> Dr. Lee</p>
            <p><strong>Schedule:</strong> Fridays, 9:00 AM - 10:30 AM</p>
            <p><strong>Cost:</strong> RM 120</p>
            <p><strong>Duration:</strong> 2 months</p>
            <p><strong>Location:</strong> Room 202</p>
            <button class="enroll-button" data-subject="English Language" data-cost="RM 120" data-duration="2 months">Select</button>
        </div>
        <div class="subject-card">
            <h3>History</h3>
            <p><strong>Teacher:</strong> Mr. Anderson</p>
            <p><strong>Schedule:</strong> Wednesdays and Fridays, 2:00 PM - 3:30 PM</p>
            <p><strong>Cost:</strong> RM 140</p>
            <p><strong>Duration:</strong> 3 months</p>
            <p><strong>Location:</strong> Room 303</p>
            <button class="enroll-button" data-subject="History" data-cost="RM 140" data-duration="3 months">Select</button>
        </div>        
    </div>

    <!-- Enrollment Form -->
    <div id="enrollment-form">
        <h2>Enrollment Form</h2>
        <p>Selected Subject: <strong id="selected-subject"></strong></p>
        <p>Cost: <strong id="subject-cost"></strong></p>
        <p>Duration: <strong id="subject-duration"></strong></p>
        <input type="text" id="student-name" placeholder="Enter your name">
        <select id="gender">
            <option value="">Select your gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
        </select>
        <input type="text" id="phone-number" placeholder="Enter your phone number">
        <input type="email" id="email-address" placeholder="Enter your email address">
        <select id="year">
            <option value="">Select your year</option>
            <option value="Year 1">Year 1</option>
            <option value="Year 2">Year 2</option>
            <option value="Year 3">Year 3</option>
            <option value="Year 4">Year 4</option>
        </select>
        <button id="submit-enrollment">Enroll</button>
    </div>

    <!-- Enrollment Status -->
    <div id="enrollment-status"></div>

    <!-- PyScript -->
    <script type="py">
        from js import document, alert
        
        # List to track enrolled subjects and their schedules
        enrolled_subjects = {}
        subject_schedules = {
            "Mathematics": ("Monday", "10:00", "11:30"),
            "Science": ("Monday", "10:00", "11:30"),
            "English Language": ("Friday", "09:00", "10:30"),
            "History": ("Monday", "14:00", "15:30")
        }
        
        def validate_name(name):
            return all(char.isalpha() or char.isspace() for char in name)

        def validate_phone(phone):
            return phone.isdigit() and len(phone) >= 10
        
        def validate_email(email):
            return "@" in email and "." in email
        
        def validate_gender(gender):
            return gender != ""
        
        def validate_year(year):
            return year != ""
        
        def is_schedule_conflict(new_subject_schedule):
            for subject, schedule in enrolled_subjects.items():
                # Check if the new subject has the same day and overlaps in time
                if (new_subject_schedule[0] == schedule[0] and
                    not (new_subject_schedule[2] <= schedule[1] or new_subject_schedule[1] >= schedule[2])):
                    return True
            return False
        
        def submit_enrollment():
            student_name = document.getElementById("student-name").value
            gender = document.getElementById("gender").value
            phone_number = document.getElementById("phone-number").value
            email_address = document.getElementById("email-address").value
            year = document.getElementById("year").value
            subject = document.getElementById("selected-subject").innerHTML
            subject_schedule = subject_schedules[subject]
        
            if not validate_name(student_name):
                alert("Name must contain only letters!")
                return
            if not validate_gender(gender):
                alert("Please select your gender!")
                return
            if not validate_phone(phone_number):
                alert("Phone number must be at least 10 digits!")
                return
            if not validate_email(email_address):
                alert("Please enter a valid email!")
                return
            if not validate_year(year):
                alert("Please select your year!")
                return
        
            # Check if the subject has already been enrolled
            if subject in enrolled_subjects:
                alert(f"You have already enrolled in {subject}.")
                return
        
            # Check for scheduling conflicts
            if is_schedule_conflict(subject_schedule):
                alert(f"Enrollment conflict! You have another subject scheduled on {subject_schedule[0]} during {subject_schedule[1]} to {subject_schedule[2]}.")
                return
        
            # Hide the success message before enrolling
            status_div = document.getElementById("enrollment-status")
            status_div.style.display = "none"
        
            # Display the success message
            status_div.innerHTML = f"<strong>Success!</strong> {student_name} ({gender}) has been enrolled in {subject}. Contact: {phone_number}, Email: {email_address}, Year: {year}."
            status_div.style.display = "block"
        
            # Add the subject and its schedule to the list of enrolled subjects
            enrolled_subjects[subject] = subject_schedule
        
            # Disable the enroll button for this subject
            disable_enroll_button(subject)
        
            # Clear input fields after successful enrollment
            clear_input_fields()
        
        def clear_input_fields():
            document.getElementById("student-name").value = ""
            document.getElementById("gender").value = ""
            document.getElementById("phone-number").value = ""
            document.getElementById("email-address").value = ""
            document.getElementById("year").value = ""
        
        def setup():
            buttons = document.querySelectorAll(".enroll-button")
            for button in buttons:
                subject_name = button.getAttribute("data-subject")
                cost = button.getAttribute("data-cost")
                duration = button.getAttribute("data-duration")
                button.onclick = lambda event, subject=subject_name, cost=cost, duration=duration: select_subject(subject, cost, duration)
            document.getElementById("submit-enrollment").onclick = lambda event: submit_enrollment()
        
        def select_subject(subject_name, cost, duration):
            # Hide the success message when a new subject is selected
            status_div = document.getElementById("enrollment-status")
            status_div.style.display = "none"
        
            document.getElementById("selected-subject").innerHTML = subject_name
            document.getElementById("subject-cost").innerHTML = cost
            document.getElementById("subject-duration").innerHTML = duration
            document.getElementById("enrollment-form").style.display = "block"
        
            # Clear input fields when a new subject is selected
            clear_input_fields()
        
        def disable_enroll_button(subject):
            # Disable the button for the enrolled subject
            buttons = document.querySelectorAll(".enroll-button")
            for button in buttons:
                if button.getAttribute("data-subject") == subject:
                    button.disabled = True
                    button.innerHTML = "Enrolled"  # Change button text to indicate it's enrolled
        
        setup()
        </script>
              

</body>
</html>